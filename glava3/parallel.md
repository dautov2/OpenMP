# parallel

Следующая директива определяет параллельную область. Область программы, которая выполняется несколькими потоками одновременно. Это фундаментальная конструкция, которая начинает параллельное выполнение.

```
#pragma omp parallel [клауза [  клауза]...]

    // структурный блок кода, который будет выполнен параллельно
```

Клауза одна из следующих:

* **if (скалярное выражение)**
* **num_threads (целое число)**
* **private (список)**
* **shared (список)**
* **default (shared | none)**
* **firstprivate (список)**
* **reduction (оператор : список)**
* **copyin (список)**
* **proc_bind (master | close | spread)**



Когда поток встречает параллельную конструкцию, то создаётся группа потоков в одном из следующих случаев:

* Не присутствует клауза **if**
* Значение скалярного выражения в клаузе **if** не равно нулю
```
void test(bool x)
{
      #pragma omp parallel if (x)
      if (omp_in_parallel())
      {
        #pragma omp single
        printf_s("parallelized with %d threads\n",
                 omp_get_num_threads());
      }
      else
      {
        printf_s("single thread\n");
      }
}
int _tmain(int argc, _TCHAR* argv[])
{
   test(false);
   test(true);
   return 0;
}
```
Результат работы:
```
single thread
parallelized with 4 threads
```

Поток становится основным потоком группы, получает номер 0, и все потоки, включая основной, выполняют параллельно. Число потоков в группе управляется переменной окружения или библиотечной функцией. Если выражение в клаузе **if**  равно 0 , то область выполняется последовательно.

В конце параллельной области осуществляется, не указанная явно, барьерная синхронизация.

OpenMP определяет следующие конструкции распределения работ:

* директива **for**
* директива **sections**
* директива **single**
* директива **workshare**
