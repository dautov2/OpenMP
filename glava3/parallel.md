# parallel

Следующая директива определяет параллельную область. Область программы, которая выполняется несколькими потоками одновременно. Это фундаментальная конструкция, которая начинает параллельное выполнение.

```
#pragma omp parallel [клауза [  клауза]...]

    // структурный блок кода, который будет выполнен параллельно
```

Клауза одна из следующих:

* **if (скалярное выражение)**
* **num_threads (целое число)**
* **private (список)**
* **shared (список)**
* **default (shared | none)**
* **firstprivate (список)**
* **reduction (оператор : список)**
* **copyin (список)**
* **proc_bind (master | close | spread)**



Когда поток встречает параллельную конструкцию, то создаётся группа потоков в одном из следующих случаев:

* Не присутствует клауза **if**
* Значение скалярного выражения в клаузе **if** не равно нулю

Поток становится основным потоком группы, получает номер 0, и все потоки, включая основной, выполняют параллельно. Число потоков в группе управляется переменной окружения или библиотечной функцией. Если выражение в клаузе **if**  равно 0 , то область выполняется последовательно.

Пример продемонстрирует использование условий.
```
#include <stdio.h>
#include <omp.h>

void test(int val)
{
    #pragma omp parallel if (val)
    if (omp_in_parallel())
    {
        #pragma omp single
        printf_s("val = %d, parallelized with %d threads\n",
                 val, omp_get_num_threads());
    }
    else
    {
        printf_s("val = %d, serialized\n", val);
    }
}

int main( )
{
    omp_set_num_threads(2);
    test(0);
    test(2);
}
```
Результат работы:
```
single thread
parallelized with 2 threads
```

В конце параллельной области осуществляется, не указанная явно, барьерная синхронизация.

OpenMP определяет следующие конструкции распределения работ:

* директива **for**
* директива **sections**
* директива **single**
* директива **workshare**
